<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MathMint Quiz - Tabbed Interface</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Header */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        
        /* Tabs */
        .tabs { display: flex; gap: 15px; margin-bottom: 30px; border-bottom: 3px solid rgba(255,255,255,0.2); }
        .tab { 
            padding: 15px 40px; 
            font-size: 1.3em; 
            font-weight: 600; 
            background: rgba(255,255,255,0.1); 
            border: none; 
            color: rgba(255,255,255,0.6); 
            cursor: pointer; 
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
            position: relative;
            top: 3px;
        }
        .tab:hover { background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.8); }
        .tab.active { 
            background: rgba(255,255,255,0.25); 
            color: white; 
            border-bottom: 3px solid #4facfe;
        }
        
        /* Tab Content */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card h2 { font-size: 1.8em; margin-bottom: 15px; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        .card h3 { font-size: 1.3em; margin: 15px 0 10px 0; }
        
        /* Buttons */
        button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 8px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        button.success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        button.warning { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        button.large { padding: 20px 50px; font-size: 1.3em; }
        
        /* Quiz Styles */
        .quiz-box { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 30px; margin: 20px 0; text-align: center; }
        .question { font-size: 3.5em; font-weight: bold; margin: 30px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .option {
            padding: 25px;
            font-size: 2em;
            font-weight: bold;
            background: rgba(255,255,255,0.25);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option:hover { background: rgba(255,255,255,0.35); transform: scale(1.05); }
        .option.correct { background: rgba(16,185,129,0.6); border-color: #10b981; animation: correctPulse 0.5s; }
        .option.wrong { background: rgba(239,68,68,0.6); border-color: #ef4444; animation: shake 0.5s; }
        
        @keyframes correctPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        
        .timer { font-size: 2.5em; font-weight: bold; margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; display: inline-block; }
        .timer.warning { color: #fbbf24; animation: pulse 1s infinite; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .progress-bar { height: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4facfe, #00f2fe); transition: width 0.3s; border-radius: 10px; }
        
        .stats { display: flex; justify-content: space-around; margin: 30px 0; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; }
        .stat { text-align: center; }
        .stat-value { font-size: 2.5em; font-weight: bold; display: block; }
        .stat-label { font-size: 1em; opacity: 0.8; margin-top: 5px; }
        
        /* Bank Info Grid */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .info-item {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #4facfe;
        }
        .info-item h4 { font-size: 0.9em; opacity: 0.8; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .info-value { font-size: 2em; font-weight: bold; color: #4facfe; }
        .info-sub { font-size: 0.85em; opacity: 0.7; margin-top: 5px; }
        
        /* Boost Hint */
        .boost-hint {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,170,0,0.2));
            border: 2px solid rgba(255,215,0,0.5);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .boost-hint.active { background: linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,170,0,0.4)); }
        
        /* Leaderboard */
        .leaderboard { margin: 20px 0; }
        .leader-item {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            margin: 8px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        .leader-item:hover { background: rgba(0,0,0,0.3); }
        .leader-item.me { background: rgba(74,172,254,0.3); border-left: 4px solid #4facfe; }
        .leader-rank { font-size: 1.5em; font-weight: bold; min-width: 40px; }
        .leader-address { flex: 1; font-family: monospace; }
        .leader-score { font-size: 1.3em; font-weight: bold; color: #fbbf24; }
        
        /* Messages */
        .message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid;
        }
        .message.success { background: rgba(16,185,129,0.2); border-color: #10b981; }
        .message.error { background: rgba(239,68,68,0.2); border-color: #ef4444; }
        .message.warning { background: rgba(251,191,36,0.2); border-color: #fbbf24; }
        .message.info { background: rgba(74,172,254,0.2); border-color: #4facfe; }
        
        .hidden { display: none; }
        
        /* Mode Cards */
        .mode-card:hover {
            border-color: rgba(255,255,255,0.6) !important;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .table-btn:hover {
            background: rgba(255,255,255,0.35) !important;
            transform: scale(1.05);
        }
        
        /* Resource links hover */
        .card a:hover, .card div[onclick]:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* Loading */
        .loading { text-align: center; padding: 20px; opacity: 0.7; }
        .spinner { display: inline-block; width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Toggle Switch */
        .toggle { position: relative; display: inline-block; width: 60px; height: 30px; margin: 0 10px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.3);
            transition: 0.4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #10b981; }
        input:checked + .slider:before { transform: translateX(30px); }
        
        @media (max-width: 768px) {
            .options { grid-template-columns: 1fr; }
            .header h1 { font-size: 2em; }
            .question { font-size: 2.5em; }
            .tab { padding: 12px 20px; font-size: 1.1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ® MathMint Quiz</h1>
            <p>Learn Times Tables, Mint Badges & Own A Bank <span style="text-decoration: line-through; color: #ef4444;">Account</span> On Mezo</p>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('quiz')">ğŸ“Š Quiz</button>
            <button class="tab" onclick="switchTab('bank')">ğŸ¦ Bank</button>
            <button class="tab" onclick="switchTab('learn')">ğŸ§­ Explore</button>
        </div>
        
        <!-- QUIZ TAB -->
        <div id="quizTab" class="tab-content active">
            
            <!-- Quiz Card -->
            <div class="card">
                <h2>ğŸ¯ Times Tables Challenge</h2>
                
                <!-- Mode Selection -->
                <div id="modeSelection" class="quiz-box">
                    <p style="font-size: 1.4em; margin: 20px 0; font-weight: 600;">ğŸ® Choose Your Challenge!</p>
                    <p style="font-size: 1.05em; margin: 15px 0; opacity: 0.9;">Pick a mode and start learning! No wallet needed!</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                        <!-- Classic Mode -->
                        <div class="mode-card" onclick="selectMode('classic')" style="background: rgba(74,172,254,0.2); padding: 25px; border-radius: 15px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;">
                            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ¯</div>
                            <h3 style="margin: 10px 0;">Classic</h3>
                            <p style="font-size: 0.95em; opacity: 0.9; line-height: 1.6;">
                                5 questions<br>
                                Random tables (1-10)<br>
                                15 seconds each<br>
                                Perfect for quick play!
                            </p>
                        </div>
                        
                        <!-- Practice Mode -->
                        <div class="mode-card" onclick="selectMode('practice')" style="background: rgba(255,215,0,0.2); padding: 25px; border-radius: 15px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;">
                            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“š</div>
                            <h3 style="margin: 10px 0;">Practice</h3>
                            <p style="font-size: 0.95em; opacity: 0.9; line-height: 1.6;">
                                10 questions<br>
                                Pick your table (2-12)<br>
                                15 seconds each<br>
                                Master one table!
                            </p>
                        </div>
                        
                        <!-- Rapid Fire Mode -->
                        <div class="mode-card" onclick="selectMode('rapid')" style="background: rgba(239,68,68,0.2); padding: 25px; border-radius: 15px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;">
                            <div style="font-size: 3em; margin-bottom: 10px;">âš¡</div>
                            <h3 style="margin: 10px 0;">Rapid Fire</h3>
                            <p style="font-size: 0.95em; opacity: 0.9; line-height: 1.6;">
                                20 questions<br>
                                Random tables (1-12)<br>
                                10 seconds each<br>
                                For speed demons!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Practice Table Selection -->
                <div id="tableSelection" class="quiz-box hidden">
                    <p style="font-size: 1.4em; margin: 20px 0; font-weight: 600;">ğŸ“š Pick Your Table to Practice</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 15px; margin: 30px 0;">
                        <button onclick="startPractice(2)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">2x</button>
                        <button onclick="startPractice(3)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">3x</button>
                        <button onclick="startPractice(4)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">4x</button>
                        <button onclick="startPractice(5)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">5x</button>
                        <button onclick="startPractice(6)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">6x</button>
                        <button onclick="startPractice(7)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">7x</button>
                        <button onclick="startPractice(8)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">8x</button>
                        <button onclick="startPractice(9)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">9x</button>
                        <button onclick="startPractice(10)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">10x</button>
                        <button onclick="startPractice(11)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">11x</button>
                        <button onclick="startPractice(12)" class="table-btn" style="padding: 20px; font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;">12x</button>
                    </div>
                    <button onclick="backToModes()" style="margin-top: 20px;">â† Back to Modes</button>
                </div>
                
                <!-- Quiz Play -->
                <div id="quizPlay" class="quiz-box hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span id="modeLabel" style="font-size: 1.1em; opacity: 0.8;"></span>
                        <span id="questionProgress" style="font-size: 1.1em; opacity: 0.8;">Question 1/5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                    </div>
                    <div class="timer" id="timer">15</div>
                    <div class="question" id="question">? Ã— ? = ?</div>
                    <div class="options" id="options"></div>
                    <div id="feedback" class="hidden" style="font-size: 1.5em; margin: 20px 0;"></div>
                </div>
                
                <!-- MUSD Boost Hint - Inside Quiz Card -->
                <div id="boostHintNoMUSD" class="boost-hint hidden" style="margin-top: 20px;">
                    <span style="font-size: 2em;">âš¡</span>
                    <div style="flex: 1;">
                        <strong style="font-size: 1.1em;">Want 1.5x Points?</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.9;">Get MUSD tokens for a super boost! 15 points instead of 10!</span>
                    </div>
                    <a href="https://testnet.mezo.org/" target="_blank" style="padding: 10px 20px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; text-decoration: none; border-radius: 10px; font-weight: bold; white-space: nowrap; font-size: 0.95em;">
                        ğŸŒŸ Get MUSD
                    </a>
                </div>
                
                <!-- MUSD Boost Enabled -->
                <div id="boostHintWithMUSD" class="boost-hint active hidden" style="margin-top: 20px;">
                    <span style="font-size: 2em;">âš¡</span>
                    <div style="flex: 1;">
                        <strong style="font-size: 1.1em;">âš¡ POWER-UP AVAILABLE!</strong><br>
                        <span id="musdBalanceDisplay" style="font-size: 0.9em; opacity: 0.95;">Turn ON the boost before playing for 1.5x points!</span>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="boostToggle" onchange="toggleBoost()">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="boostActiveMsg" class="message success hidden" style="margin-top: 15px;">
                    âœ… <strong>Boost Active!</strong> Earning 15 points per correct answer! ğŸš€
                </div>
                
                <!-- Quiz Results -->
                <div id="quizResults" class="hidden">
                    <h2 style="font-size: 2.5em; text-align: center; margin: 20px 0;">ğŸ‰ Quiz Complete!</h2>
                    
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-value" id="correctCount">0</span>
                            <span class="stat-label">âœ… Correct</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="pointsEarned">0</span>
                            <span class="stat-label">â­ Points</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="wrongCount">0</span>
                            <span class="stat-label">âŒ Wrong</span>
                        </div>
                    </div>
                    
                    <div id="boostAppliedMessage" class="message warning hidden" style="margin: 20px 0;">
                        <strong>âš¡ MUSD Boost Applied!</strong><br>
                        Your points were boosted by 1.5x because you had the boost enabled! ğŸ”¥
                    </div>
                    
                    <div id="walletRequiredMsg" class="message info hidden" style="margin: 20px 0;">
                        <strong>ğŸ’¾ Want to Keep These Points Forever?</strong><br>
                        Connect your bank in the "Bank" tab! Don't have one yet? We'll guide you through creating it - super easy! ğŸ¦âœ¨
                    </div>
                    
                    <div style="text-align: center; margin: 25px 0;">
                        <button class="success large" onclick="saveScore()">ğŸ’¾ Save Points to My Bank!</button>
                        <button onclick="playAgain()">ğŸ”„ Play Again</button>
                    </div>
                    
                    <div id="saveMessage" class="message hidden"></div>
                </div>
            </div>
            
            <!-- Leaderboard Card -->
            <div class="card">
                <h2>ğŸ† Top Champions</h2>
                <div id="leaderboardContent" class="loading">
                    <div class="spinner"></div>
                    <p>Loading leaderboard...</p>
                </div>
            </div>
        </div>
        
        <!-- BANK TAB -->
        <div id="bankTab" class="tab-content">
            
            <!-- Not Connected State -->
            <div id="notConnected" class="card">
                <h2>ğŸ¦ Welcome to Your Bank of Good Times!</h2>
                <p style="font-size: 1.2em; margin: 20px 0; line-height: 1.6;">
                    Ready to save your quiz points forever and own digital badges? <br>
                    Connect or create your own bank on the blockchain! ğŸš€
                </p>
                
                <div style="background: rgba(255,215,0,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,215,0,0.3); margin: 25px 0;">
                    <h3 style="margin: 0 0 15px 0; font-size: 1.3em;">âœ¨ Why Your Own Bank?</h3>
                    <ul style="line-height: 2; margin-left: 20px; font-size: 1.05em;">
                        <li><strong>YOU are in control</strong> - No middleman needed!</li>
                        <li><strong>Save points forever</strong> - Stored on the blockchain</li>
                        <li><strong>Mint cool badges</strong> - Digital collectibles (NFTs)</li>
                        <li><strong>It's free practice</strong> - This is testnet, zero risk!</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 15px; margin: 30px 0; flex-wrap: wrap; justify-content: center;">
                    <button class="success large" onclick="showWelcomeModal()">ğŸ¦ Connect to My Bank</button>
                    <button class="large" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);" onclick="showCreateBankGuide()">âœ¨ Create My First Bank</button>
                </div>
                
                <div class="message info">
                    <strong>ğŸ’¡ New to Web3?</strong><br>
                    Don't worry! Creating your bank means installing MetaMask (a free digital wallet). We'll guide you step-by-step - it takes just 2 minutes! Think of it like installing any other browser extension.
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="connected" class="hidden">
                
                <!-- Wallet Overview -->
                <div class="card">
                    <h2>ğŸ’¼ Wallet Overview</h2>
                    <div id="walletAddress" style="font-family: monospace; font-size: 1.1em; margin: 10px 0; opacity: 0.8;"></div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <h4>ğŸ’° tBTC Balance</h4>
                            <div class="info-value" id="tbtcBalance">Loading...</div>
                            <div class="info-sub">
                                Testnet Bitcoin<br>
                                <a href="https://faucet.test.mezo.org" target="_blank" style="color: #4facfe; font-weight: bold; text-decoration: underline; font-size: 0.9em;">ğŸ Get Free tBTC</a>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>âš¡ MUSD Balance</h4>
                            <div class="info-value" id="musdBalance">Loading...</div>
                            <div class="info-sub">
                                <span id="musdStatus">Checking...</span><br>
                                <a href="https://testnet.mezo.org/" target="_blank" style="color: #ffd700; font-weight: bold; text-decoration: underline;">Swap for MUSD</a>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>ğŸ¯ Quiz Points (Saved)</h4>
                            <div class="info-value" id="savedPoints">Loading...</div>
                            <div class="info-sub">On blockchain</div>
                        </div>
                        <div class="info-item" id="pendingPointsItem" class="hidden">
                            <h4>â³ Pending Points</h4>
                            <div class="info-value" id="pendingPoints">0</div>
                            <div class="info-sub">Not yet saved</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="refreshBankData()" style="background: rgba(74,172,254,0.3); padding: 10px 20px; font-size: 0.95em;">ğŸ”„ Refresh Data</button>
                    </div>
                </div>
                
                <!-- NFT Badge -->
                <div class="card">
                    <h2>ğŸ¨ My Magical Badges Collection</h2>
                    <div id="nftContent" class="loading">
                        <div class="spinner"></div>
                        <p>Checking your badge collection...</p>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- EXPLORE/LEARN TAB -->
        <div id="learnTab" class="tab-content">
            <div class="card">
                <h2>ğŸ§­ Explore & Learn</h2>
                <p style="font-size: 1.2em; margin: 15px 0;">Welcome to your adventure in Web3! Let's learn cool stuff together! ğŸš€</p>
            </div>
            
            <!-- What is Your Bank? -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ¦ What's This "Bank" Thing?</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                        Imagine if your piggy bank was <strong>magical</strong> and <strong>nobody could touch it but you</strong> - not even grown-ups! That's what your "bank" (we call it a wallet) is like.
                    </p>
                    <div style="background: rgba(74,172,254,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong style="font-size: 1.1em;">âœ¨ Cool Things About Your Bank:</strong>
                        <ul style="margin: 10px 0 0 20px; line-height: 2;">
                            <li><strong>Only YOU</strong> can open it (with your secret password)</li>
                            <li>No one can take your stuff without asking</li>
                            <li>You're the boss - you decide everything!</li>
                            <li>It works anywhere in the world ğŸŒ</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Staying Safe Online -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ›¡ï¸ Staying Safe Online</h3>
                <div style="background: rgba(255,215,0,0.15); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                        Just like you wouldn't tell a stranger where you hide your piggy bank, here are important rules for staying safe:
                    </p>
                    <div style="display: grid; gap: 15px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                            <strong>ğŸ”‘ Secret Words (Seed Phrase)</strong><br>
                            <span style="font-size: 0.95em; opacity: 0.9;">Your 12 magic words are like the key to your piggy bank. Write them on paper and hide them somewhere safe. NEVER tell anyone - not even someone saying they're "support"!</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #fbbf24;">
                            <strong>ğŸ“ Write It Down</strong><br>
                            <span style="font-size: 0.95em; opacity: 0.9;">Write your secret words on real paper (not on your phone or computer). Paper can't be hacked by bad guys on the internet!</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #ef4444;">
                            <strong>ğŸš« Never Share</strong><br>
                            <span style="font-size: 0.95em; opacity: 0.9;">Real helpers will NEVER ask for your secret words. If someone asks, they're trying to trick you! Always ask a parent or teacher if you're not sure.</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #4facfe;">
                            <strong>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ask for Help</strong><br>
                            <span style="font-size: 0.95em; opacity: 0.9;">If something feels weird or confusing, always ask a parent, teacher, or trusted adult. There are no silly questions!</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- What is "Hard Money"? -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ’ª What Makes Money "Hard"?</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                        No, we're not talking about hard like a rock! "Hard money" means <strong>money that's rare and can't be copied easily</strong>.
                    </p>
                    <div style="background: rgba(255,215,0,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong style="font-size: 1.1em;">ğŸ® Think of it like this:</strong>
                        <p style="margin: 10px 0 0 0; line-height: 1.8;">
                            <strong>Soft Money:</strong> Like copying a drawing - you can make as many as you want! ğŸ“„ğŸ“„ğŸ“„<br>
                            <strong>Hard Money:</strong> Like a limited edition trading card - there's only a certain number! â­
                        </p>
                    </div>
                    <p style="font-size: 1.05em; line-height: 1.8; margin-top: 15px;">
                        Bitcoin is "hard money" because there will only ever be 21 million bitcoins. Nobody can make more - not even banks or governments! That's what makes it special. ğŸŒŸ
                    </p>
                </div>
            </div>
            
            <!-- Self-Custody -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ‘‘ Being Your Own Boss (Self-Custody)</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                        "Self-custody" is a fancy way of saying <strong>"you hold your own stuff"</strong>. Let's compare:
                    </p>
                    <div style="display: grid; gap: 15px; margin: 20px 0;">
                        <div style="background: rgba(239,68,68,0.2); padding: 15px; border-radius: 10px;">
                            <strong>ğŸ¦ Old Way (Regular Bank):</strong>
                            <p style="margin: 10px 0 0 0; font-size: 0.95em; line-height: 1.7;">
                                The bank holds your money<br>
                                They can say "no" sometimes<br>
                                They know everything you buy<br>
                                You have to ask permission
                            </p>
                        </div>
                        <div style="background: rgba(16,185,129,0.2); padding: 15px; border-radius: 10px;">
                            <strong>âœ¨ New Way (Self-Custody):</strong>
                            <p style="margin: 10px 0 0 0; font-size: 0.95em; line-height: 1.7;">
                                YOU hold your own money<br>
                                Nobody can say "no" to you<br>
                                Your business is private<br>
                                You're the boss! ğŸ‘‘
                            </p>
                        </div>
                    </div>
                    <div style="background: rgba(255,215,0,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong>âš¡ With Great Power Comes Great Responsibility!</strong><br>
                        <span style="font-size: 0.95em;">Being your own boss is awesome, but it means YOU need to keep your secret words safe. No one can help you if you lose them!</span>
                    </div>
                </div>
            </div>
            
            <!-- Privacy & Why It Matters -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ•µï¸ Privacy - Your Superpower!</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                        Privacy means <strong>choosing what to share and what to keep to yourself</strong>. Just like you might not want everyone knowing what's in your diary, you might not want everyone knowing everything you do online!
                    </p>
                    <div style="background: rgba(74,172,254,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong style="font-size: 1.1em;">ğŸ­ Privacy is NOT about hiding bad stuff!</strong>
                        <p style="margin: 10px 0 0 0; line-height: 1.7;">It's about:
                        <ul style="margin: 10px 0 0 20px; line-height: 2;">
                            <li>Keeping your stuff safe from bad guys</li>
                            <li>Not letting companies spy on everything you do</li>
                            <li>Having a space that's just YOURS</li>
                            <li>Staying safe online</li>
                        </ul>
                        </p>
                    </div>
                    <p style="font-size: 1.05em; line-height: 1.8; margin-top: 15px;">
                        With your own "bank" (wallet), you have more privacy because nobody needs to know your name, address, or how old you are. Cool, right? ğŸ˜
                    </p>
                </div>
            </div>
            
            <!-- Magical Badges -->
            <div class="card" style="background: linear-gradient(135deg, rgba(240,147,251,0.3), rgba(245,87,108,0.3)); border: 2px solid rgba(240,147,251,0.5);">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">âœ¨ Collect Magical Badges!</h3>
                <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">
                    As you play and earn points, you unlock super cute badges! Each one is special and yours forever! ğŸ¨
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #f093fb;">
                        <div style="font-size: 3em; margin: 10px 0;">ğŸ²</div>
                        <strong style="font-size: 1.1em;">Baby Dragon</strong><br>
                        <span style="font-size: 0.85em; opacity: 0.9;">Level 1</span><br>
                        <span style="color: #fbbf24; font-weight: bold;">50 points</span><br>
                        <span style="font-size: 0.85em; opacity: 0.8;">Your first magical friend!</span>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #f5576c;">
                        <div style="font-size: 3em; margin: 10px 0;">ğŸ¦„âœ¨</div>
                        <strong style="font-size: 1.1em;">Sparkle Unicorn</strong><br>
                        <span style="font-size: 0.85em; opacity: 0.9;">Level 2</span><br>
                        <span style="color: #fbbf24; font-weight: bold;">100 points</span><br>
                        <span style="font-size: 0.85em; opacity: 0.8;">Rare and sparkly!</span>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #4facfe;">
                        <div style="font-size: 3em; margin: 10px 0;">ğŸ¼ğŸŒˆ</div>
                        <strong style="font-size: 1.1em;">Rainbow Panda</strong><br>
                        <span style="font-size: 0.85em; opacity: 0.9;">Level 3</span><br>
                        <span style="color: #fbbf24; font-weight: bold;">200 points</span><br>
                        <span style="font-size: 0.85em; opacity: 0.8;">Super rare cuteness!</span>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #00f2fe;">
                        <div style="font-size: 3em; margin: 10px 0;">ğŸ±â­</div>
                        <strong style="font-size: 1.1em;">Galaxy Kitten</strong><br>
                        <span style="font-size: 0.85em; opacity: 0.9;">Level 4</span><br>
                        <span style="color: #fbbf24; font-weight: bold;">500 points</span><br>
                        <span style="font-size: 0.85em; opacity: 0.8;">Epic cosmic companion!</span>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #ffd700;">
                        <div style="font-size: 3em; margin: 10px 0;">ğŸ”¥ğŸ¦…</div>
                        <strong style="font-size: 1.1em;">Legendary Phoenix</strong><br>
                        <span style="font-size: 0.85em; opacity: 0.9;">Level 5</span><br>
                        <span style="color: #ffd700; font-weight: bold;">1000 points</span><br>
                        <span style="font-size: 0.85em; opacity: 0.8;">Ultra legendary!</span>
                    </div>
                </div>
                
                <div style="background: rgba(255,215,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <strong>ğŸ® How to Collect:</strong>
                    <p style="margin: 10px 0; line-height: 1.7;">
                        1. Play quiz and earn points<br>
                        2. Save your points to your bank<br>
                        3. When you reach enough points, mint your badge!<br>
                        4. It's yours forever - nobody can take it away!
                    </p>
                </div>
            </div>
            
            <!-- Practice Makes Perfect -->
            <div class="card" style="background: linear-gradient(135deg, rgba(74,172,254,0.3), rgba(16,185,129,0.3)); border: 2px solid rgba(74,172,254,0.5);">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ® Why This is Testnet (Practice Mode)</h3>
                <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 15px;">
                    You're playing with <strong>fake money</strong> right now - it's like Monopoly money! This is called "testnet" and it's PERFECT for learning because:
                </p>
                <ul style="margin-left: 20px; line-height: 2; font-size: 1.05em;">
                    <li>âœ… You can't lose real money</li>
                    <li>âœ… You can make mistakes and learn</li>
                    <li>âœ… It's 100% safe to experiment</li>
                    <li>âœ… You can practice as much as you want</li>
                </ul>
                <p style="font-size: 1.05em; line-height: 1.8; margin-top: 15px; background: rgba(255,215,0,0.2); padding: 15px; border-radius: 10px;">
                    <strong>ğŸ’¡ Pro Tip:</strong> Before you ever use REAL crypto, practice here first. It's like learning to ride a bike with training wheels! ğŸš²
                </p>
            </div>
            
            <!-- Want to Learn More? -->
            <div class="card">
                <h3 style="font-size: 1.5em; margin-bottom: 15px;">ğŸ“š Want to Learn Even More?</h3>
                <p style="font-size: 1.05em; line-height: 1.8; margin-bottom: 15px;">
                    Ask your parents or teacher to check out these resources together:
                </p>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div onclick="showCreateBankGuide()" style="background: rgba(255,215,0,0.2); padding: 15px; border-radius: 10px; cursor: pointer; border-left: 4px solid #fbbf24; transition: all 0.2s;">
                        <strong>ğŸ¥ Video: How to Create MetaMask Wallet</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.9;">Step-by-step video tutorial for beginners</span>
                    </div>
                    <a href="../SECURITY_GUIDE.md" target="_blank" style="background: rgba(74,172,254,0.2); padding: 15px; border-radius: 10px; text-decoration: none; color: inherit; border-left: 4px solid #4facfe;">
                        <strong>ğŸ” Complete Security Guide</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.9;">Detailed safety tips for the whole family</span>
                    </a>
                    <a href="../USER_GUIDE.md" target="_blank" style="background: rgba(16,185,129,0.2); padding: 15px; border-radius: 10px; text-decoration: none; color: inherit; border-left: 4px solid #10b981;">
                        <strong>ğŸ“– User Guide</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.9;">How to use everything in this app</span>
                    </a>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Welcome Modal -->
    <div id="welcomeModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 40px; border-radius: 20px; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <h2 style="text-align: center; margin-bottom: 15px; font-size: 2em; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 15px;">ğŸ¦ Welcome to Your Bank of Good Times!</h2>
            <p style="text-align: center; font-size: 1.3em; margin-bottom: 25px; font-weight: 600;">
                ğŸ‰ <strong>Congratulations!</strong> You're about to become your own bank!
            </p>
            
            <div style="background: rgba(255,255,255,0.15); padding: 20px; margin: 20px 0; border-radius: 12px; border-left: 4px solid #4facfe;">
                <h3 style="margin: 0 0 12px 0; font-size: 1.3em;">âœ¨ What Makes This Special?</h3>
                <p style="line-height: 1.7; font-size: 1.05em;">Unlike regular banks, <strong>YOU are in complete control</strong>. No middleman, no permissions needed, no one can freeze your funds. This is financial freedom!</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); padding: 20px; margin: 20px 0; border-radius: 12px; border-left: 4px solid #4facfe;">
                <h3 style="margin: 0 0 12px 0; font-size: 1.3em;">ğŸ”‘ 5 Quick Security Tips (30 seconds!)</h3>
                <ul style="line-height: 2; margin-left: 20px; font-size: 1.05em;">
                    <li><strong>Never share your seed phrase</strong> - Not even with "support"! It's like your master password.</li>
                    <li><strong>Write it on paper</strong> - Not on your phone. Paper can't be hacked!</li>
                    <li><strong>This is testnet</strong> - Safe to learn! Free coins, zero risk.</li>
                    <li><strong>You're in control</strong> - Every transaction needs YOUR approval.</li>
                    <li><strong>Start small</strong> - Test everything before doing anything major.</li>
                </ul>
            </div>
            
            <div style="background: rgba(255,215,0,0.2); padding: 20px; margin: 20px 0; border-radius: 12px; border-left: 4px solid #ffd700;">
                <h3 style="margin: 0 0 10px 0; font-size: 1.2em;">ğŸ’ª You've Got This!</h3>
                <p style="line-height: 1.7; font-size: 1.05em;">Millions of people use self-custody every day. The difference? They took the first step - just like you're doing now!</p>
            </div>
            
            <div style="margin: 25px 0; padding: 18px; background: rgba(255,215,0,0.15); border: 2px solid rgba(255,215,0,0.4); border-radius: 12px; display: flex; align-items: center;">
                <input type="checkbox" id="understandCheck" style="width: 22px; height: 22px; margin-right: 12px; cursor: pointer;">
                <label for="understandCheck" style="font-size: 1.15em; font-weight: 600; cursor: pointer;">I understand I'm in control and will keep my seed phrase safe!</label>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="closeWelcomeModal()" style="flex: 1; background: rgba(255,255,255,0.2); padding: 15px; font-size: 1.1em;">Maybe Later</button>
                <button id="continueBtn" onclick="proceedFromModal()" disabled style="flex: 1; padding: 15px; font-size: 1.1em;">Let's Go! ğŸš€</button>
            </div>
            
            <div style="text-align: center; margin-top: 18px; font-size: 0.95em;">
                <a href="../SECURITY_GUIDE.md" target="_blank" style="color: #4facfe; text-decoration: underline;">ğŸ“š Want to learn more? Read our complete Security Guide</a>
            </div>
        </div>
    </div>
    
    <!-- Create Bank Guide Modal -->
    <div id="createBankModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px);">
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 40px; border-radius: 20px; max-width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <h2 style="text-align: center; margin-bottom: 15px; font-size: 2em; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 15px;">ğŸŒŸ Let's Create Your First Bank!</h2>
            <p style="text-align: center; font-size: 1.2em; margin-bottom: 25px;">
                ğŸ‰ <strong>Exciting!</strong> You're about to open your own bank. Let me walk you through it, friend!
            </p>
            
            <!-- Video Tutorial -->
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 25px 0;">
                <h3 style="text-align: center; margin: 0 0 15px 0; font-size: 1.3em;">ğŸ¥ Watch This Quick Tutorial</h3>
                <p style="text-align: center; font-size: 1.05em; margin-bottom: 15px;">Follow along with this video to create your MetaMask wallet!</p>
                <video controls style="width: 100%; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    <source src="https://customer-assets.emergentagent.com/job_mathmint-quiz/artifacts/lxymrigy_create_metamask_wallet.mp4" type="video/mp4">
                    Your browser doesn't support video playback.
                </video>
                <p style="text-align: center; font-size: 0.9em; margin-top: 10px; opacity: 0.8;">ğŸ’¡ Tip: Pause and replay as many times as you need!</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); padding: 20px; margin: 15px 0; border-radius: 12px; border-left: 4px solid #4facfe;">
                <h3 style="margin: 0 0 10px 0; font-size: 1.3em;">ğŸ¦Š Step 1: Install MetaMask (Your Bank Manager)</h3>
                <p style="line-height: 1.7; font-size: 1.05em; margin-bottom: 12px;"><strong>MetaMask</strong> is like your bank manager, but YOU are the boss! It's free and takes 2 minutes.</p>
                <ol style="line-height: 2; margin-left: 20px; font-size: 1.05em;">
                    <li>Click this link: <a href="https://metamask.io" target="_blank" style="color: #4facfe; font-weight: bold; text-decoration: underline;">metamask.io</a></li>
                    <li>Click "Download" for your browser</li>
                    <li>Add the extension (it's a cute fox ğŸ¦Š)</li>
                    <li>Click "Create a wallet"</li>
                </ol>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); padding: 20px; margin: 15px 0; border-radius: 12px; border-left: 4px solid #4facfe;">
                <h3 style="margin: 0 0 10px 0; font-size: 1.3em;">ğŸ”‘ Step 2: Save Your Secret Phrase (SUPER IMPORTANT!)</h3>
                <p style="line-height: 1.7; font-size: 1.05em; margin-bottom: 12px;">MetaMask will show you 12 special words. This is your <strong>master key</strong>!</p>
                <ul style="line-height: 2; margin-left: 20px; font-size: 1.05em;">
                    <li><strong>Write these words on paper</strong> ğŸ“ Right now!</li>
                    <li><strong>Store paper somewhere safe</strong> ğŸ”’ Like a drawer or safe</li>
                    <li><strong>Never share with ANYONE</strong> ğŸš« Not even "support"</li>
                    <li><strong>Don't take a photo</strong> ğŸ“¸ Paper can't be hacked!</li>
                </ul>
                <div style="background: rgba(255,68,68,0.3); padding: 15px; border-radius: 10px; border-left: 4px solid #ef4444; margin-top: 12px;">
                    âš ï¸ <strong>CRITICAL:</strong> If you lose these words, you lose your bank forever. No recovery possible!
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); padding: 20px; margin: 15px 0; border-radius: 12px; border-left: 4px solid #4facfe;">
                <h3 style="margin: 0 0 10px 0; font-size: 1.3em;">ğŸ® Step 3: Come Back Here!</h3>
                <p style="line-height: 1.7; font-size: 1.05em;">Once MetaMask is installed:</p>
                <ol style="line-height: 2; margin-left: 20px; font-size: 1.05em;">
                    <li>You'll see the fox icon ğŸ¦Š in your browser</li>
                    <li>Come back to this page</li>
                    <li>Click "Connect to My Bank" button</li>
                    <li>We'll help you connect! ğŸ‰</li>
                </ol>
            </div>
            
            <div style="background: rgba(255,215,0,0.2); padding: 18px; margin: 20px 0; border-radius: 12px; border-left: 4px solid #ffd700;">
                <h3 style="margin: 0 0 8px 0; font-size: 1.2em;">ğŸ’¡ Pro Tip: This is Safe Practice!</h3>
                <p style="line-height: 1.7; font-size: 1.05em;">You'll be using <strong>testnet</strong> - fake money for learning! No risk, pure practice. When you're comfortable, you can graduate to real crypto. Baby steps! ğŸ‘¶â¡ï¸ğŸš€</p>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="closeCreateBankModal()" style="flex: 1; background: rgba(255,255,255,0.2); padding: 15px; font-size: 1.1em;">Close</button>
                <button onclick="openMetaMaskSite()" class="success" style="flex: 1; padding: 15px; font-size: 1.1em;">Take Me to MetaMask! ğŸ¦Š</button>
            </div>
            
            <div style="text-align: center; margin-top: 18px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <strong style="font-size: 1.05em;">Questions? Confused?</strong><br>
                <a href="../SECURITY_GUIDE.md" target="_blank" style="color: #4facfe; font-weight: bold; text-decoration: underline;">Read our beginner-friendly Security Guide</a>
            </div>
        </div>
    </div>

    <script>
        // Contract Configuration
        const MEZO_TESTNET = {
            chainId: '0x7b7b',
            chainName: 'Mezo Testnet',
            rpcUrls: ['https://rpc.test.mezo.org'],
            nativeCurrency: { name: 'tBTC', symbol: 'tBTC', decimals: 18 },
            blockExplorerUrls: ['https://explorer.test.mezo.org']
        };
        
        const QUIZ_ADDR = '0x59bDB59107f29e9712A37c7015ee28675DD7d30f';
        const NFT_ADDR = '0x03672f6b20622176554a4C0ba7B037d9dCE531f0';
        const MUSD_ADDR = '0x118917a40FAF1CD7a13dB0Ef56C86De7973Ac503';
        
        const QUIZ_ABI = [
            "function updateScore(address user, uint256 points)",
            "function getScore(address user) view returns (uint256)",
            "function canMintNFT(address user) view returns (bool)",
            "function getLeaderboard() view returns (address[], uint256[])"
        ];
        
        const NFT_ABI = [
            "function mint(string memory tokenURI)",
            "function hasMinted(address player) view returns (bool)",
            "function balanceOf(address owner) view returns (uint256)"
        ];
        
        const MUSD_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function decimals() view returns (uint8)"
        ];
        
        // State
        let provider, signer, quiz, nft, musd, userAddr;
        let quizQuestions = [];
        let currentQuestion = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let points = 0;
        let timerInterval;
        let timeLeft = 15;
        let boostEnabled = false;
        let musdBalance = 0;
        let currentMode = 'classic';
        let practiceTable = null;
        let totalQuestions = 5;
        let questionTimeLimit = 15;
        
        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'bank' && userAddr) {
                refreshBankData();
            } else if (tabName === 'quiz') {
                loadLeaderboard();
            }
        }
        
        // Quiz Mode Selection
        function selectMode(mode) {
            currentMode = mode;
            
            if (mode === 'classic') {
                totalQuestions = 5;
                questionTimeLimit = 15;
                practiceTable = null;
                startQuiz();
            } else if (mode === 'practice') {
                totalQuestions = 10;
                questionTimeLimit = 15;
                document.getElementById('modeSelection').classList.add('hidden');
                document.getElementById('tableSelection').classList.remove('hidden');
            } else if (mode === 'rapid') {
                totalQuestions = 20;
                questionTimeLimit = 10;
                practiceTable = null;
                startQuiz();
            }
        }
        
        function startPractice(table) {
            practiceTable = table;
            startQuiz();
        }
        
        function backToModes() {
            document.getElementById('tableSelection').classList.add('hidden');
            document.getElementById('modeSelection').classList.remove('hidden');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            // Load leaderboard automatically
            loadLeaderboard();
            
            // Check if wallet is already connected
            checkWalletConnection();
        });
        
        async function checkWalletConnection() {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connect();
                    }
                } catch (err) {
                    console.log('Not connected');
                }
            }
        }
        
        // Modal Functions
        function showWelcomeModal() {
            const hasSeenWelcome = localStorage.getItem('mathMintWelcomeSeen');
            if (!hasSeenWelcome) {
                const modal = document.getElementById('welcomeModal');
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                document.getElementById('understandCheck').addEventListener('change', function() {
                    document.getElementById('continueBtn').disabled = !this.checked;
                });
            } else {
                connect();
            }
        }
        
        function closeWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }
        
        function proceedFromModal() {
            localStorage.setItem('mathMintWelcomeSeen', 'true');
            closeWelcomeModal();
            connect();
        }
        
        function showCreateBankGuide() {
            const modal = document.getElementById('createBankModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }
        
        function closeCreateBankModal() {
            const modal = document.getElementById('createBankModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }
        
        function openMetaMaskSite() {
            window.open('https://metamask.io', '_blank');
        }
        
        // Wallet Connection
        async function connect() {
            try {
                if (!window.ethereum) {
                    alert('Please install MetaMask!');
                    return;
                }
                
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddr = await signer.getAddress();
                
                const network = await provider.getNetwork();
                const chainId = '0x' + network.chainId.toString(16);
                
                if (chainId !== MEZO_TESTNET.chainId) {
                    await switchNetwork();
                    return;
                }
                
                quiz = new ethers.Contract(QUIZ_ADDR, QUIZ_ABI, signer);
                nft = new ethers.Contract(NFT_ADDR, NFT_ABI, signer);
                musd = new ethers.Contract(MUSD_ADDR, MUSD_ABI, provider);
                
                document.getElementById('notConnected').classList.add('hidden');
                document.getElementById('connected').classList.remove('hidden');
                
                await refreshBankData();
                
            } catch (err) {
                console.error('Connection error:', err);
                alert('Connection failed: ' + err.message);
            }
        }
        
        async function switchNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [MEZO_TESTNET]
                });
                location.reload();
            } catch (err) {
                alert('Failed to switch network: ' + err.message);
            }
        }
        
        // Refresh Bank Data
        async function refreshBankData() {
            document.getElementById('walletAddress').textContent = 'ğŸ“ ' + userAddr.substring(0, 8) + '...' + userAddr.substring(38);
            
            // Get tBTC balance
            try {
                const balance = await provider.getBalance(userAddr);
                const tbtc = parseFloat(ethers.utils.formatEther(balance)).toFixed(4);
                document.getElementById('tbtcBalance').textContent = tbtc;
            } catch (err) {
                console.error('tBTC balance error:', err);
                document.getElementById('tbtcBalance').textContent = 'Error';
            }
            
            // Get MUSD balance and update boost hints
            try {
                const balance = await musd.balanceOf(userAddr);
                const decimals = await musd.decimals();
                musdBalance = parseFloat(ethers.utils.formatUnits(balance, decimals));
                document.getElementById('musdBalance').textContent = musdBalance.toFixed(2);
                
                if (musdBalance >= 1) {
                    // User has MUSD - show the toggle
                    document.getElementById('musdStatus').textContent = 'âœ… Boost available!';
                    
                    // Update boost hints if they exist (they're in Quiz tab)
                    const boostHintNoMUSD = document.getElementById('boostHintNoMUSD');
                    const boostHintWithMUSD = document.getElementById('boostHintWithMUSD');
                    const musdBalanceDisplay = document.getElementById('musdBalanceDisplay');
                    
                    if (boostHintNoMUSD) boostHintNoMUSD.classList.add('hidden');
                    if (boostHintWithMUSD) boostHintWithMUSD.classList.remove('hidden');
                    if (musdBalanceDisplay) {
                        musdBalanceDisplay.textContent = `You have ${musdBalance.toFixed(2)} MUSD! Turn ON the boost before playing for 1.5x points! ğŸ”¥`;
                    }
                } else {
                    // User doesn't have MUSD - show the swap prompt
                    document.getElementById('musdStatus').textContent = 'Need 1+ MUSD for boost';
                    
                    // Update boost hints if they exist (they're in Quiz tab)
                    const boostHintNoMUSD = document.getElementById('boostHintNoMUSD');
                    const boostHintWithMUSD = document.getElementById('boostHintWithMUSD');
                    
                    if (boostHintNoMUSD) boostHintNoMUSD.classList.remove('hidden');
                    if (boostHintWithMUSD) boostHintWithMUSD.classList.add('hidden');
                }
            } catch (err) {
                console.error('MUSD balance error:', err);
                document.getElementById('musdBalance').textContent = 'Error';
                document.getElementById('musdStatus').textContent = 'Error loading';
            }
            
            // Get saved quiz points
            try {
                const score = await quiz.getScore(userAddr);
                document.getElementById('savedPoints').textContent = score.toString();
            } catch (err) {
                console.error('Quiz score error:', err);
                document.getElementById('savedPoints').textContent = 'Error';
            }
            
            // Check NFT status
            checkNFTStatus();
        }
        
        // Badge Tiers System
        const badgeTiers = [
            { level: 1, name: "Baby Dragon", emoji: "ğŸ²", points: 50, color: "#f093fb", description: "Your first magical friend!" },
            { level: 2, name: "Sparkle Unicorn", emoji: "ğŸ¦„âœ¨", points: 100, color: "#f5576c", description: "Rare and sparkly!" },
            { level: 3, name: "Rainbow Panda", emoji: "ğŸ¼ğŸŒˆ", points: 200, color: "#4facfe", description: "Super rare cuteness!" },
            { level: 4, name: "Galaxy Kitten", emoji: "ğŸ±â­", points: 500, color: "#00f2fe", description: "Epic cosmic companion!" },
            { level: 5, name: "Legendary Phoenix", emoji: "ğŸ”¥ğŸ¦…", points: 1000, color: "#ffd700", description: "Ultra legendary!" }
        ];
        
        function getBadgeForPoints(points) {
            for (let i = badgeTiers.length - 1; i >= 0; i--) {
                if (points >= badgeTiers[i].points) {
                    return badgeTiers[i];
                }
            }
            return null;
        }
        
        function getNextBadge(points) {
            for (let i = 0; i < badgeTiers.length; i++) {
                if (points < badgeTiers[i].points) {
                    return badgeTiers[i];
                }
            }
            return null;
        }
        
        async function checkNFTStatus() {
            const content = document.getElementById('nftContent');
            try {
                const hasMinted = await nft.hasMinted(userAddr);
                const canMint = await quiz.canMintNFT(userAddr);
                const savedScore = parseInt(await quiz.getScore(userAddr));
                
                if (hasMinted) {
                    const balance = await nft.balanceOf(userAddr);
                    const currentBadge = getBadgeForPoints(savedScore);
                    
                    let badgeDisplay = '';
                    if (currentBadge) {
                        badgeDisplay = `
                            <div style="text-align: center; margin: 20px 0;">
                                <div style="font-size: 5em; margin: 20px 0;">${currentBadge.emoji}</div>
                                <h3 style="font-size: 1.8em; color: ${currentBadge.color}; margin: 10px 0;">${currentBadge.name}</h3>
                                <p style="font-size: 1.1em; opacity: 0.9;">${currentBadge.description}</p>
                                <div style="background: rgba(255,215,0,0.2); padding: 12px; border-radius: 10px; margin-top: 15px;">
                                    <strong>Level ${currentBadge.level} Badge Holder!</strong><br>
                                    You've earned ${savedScore} points! ğŸŒŸ
                                </div>
                            </div>
                        `;
                    }
                    
                    const nextBadge = getNextBadge(savedScore);
                    let nextBadgeInfo = '';
                    if (nextBadge) {
                        const pointsNeeded = nextBadge.points - savedScore;
                        nextBadgeInfo = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                                <strong>ğŸ¯ Next Badge: ${nextBadge.emoji} ${nextBadge.name}</strong><br>
                                <span style="font-size: 0.95em; opacity: 0.9;">Only ${pointsNeeded} more points to unlock!</span>
                                <div style="background: rgba(0,0,0,0.2); height: 10px; border-radius: 5px; margin: 10px 0; overflow: hidden;">
                                    <div style="height: 100%; background: linear-gradient(90deg, #4facfe, #00f2fe); width: ${(savedScore / nextBadge.points * 100)}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        `;
                    } else {
                        nextBadgeInfo = `
                            <div style="background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,170,0,0.3)); padding: 15px; border-radius: 10px; margin-top: 20px; border: 2px solid rgba(255,215,0,0.5);">
                                <strong>ğŸ‘‘ MAX LEVEL ACHIEVED!</strong><br>
                                <span style="font-size: 0.95em;">You've collected all badges! You're a legend! ğŸ†</span>
                            </div>
                        `;
                    }
                    
                    content.innerHTML = `
                        <div class="message success">
                            <strong>ğŸ‰ You own ${balance} MathMint Badge${balance > 1 ? 's' : ''}!</strong><br>
                            Check your MetaMask NFTs tab to view them!
                        </div>
                        ${badgeDisplay}
                        ${nextBadgeInfo}
                    `;
                } else if (canMint) {
                    const badge = getBadgeForPoints(savedScore);
                    content.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 6em; margin: 20px 0;">${badge.emoji}</div>
                            <h3 style="font-size: 2em; color: ${badge.color}; margin: 10px 0;">Ready to Mint!</h3>
                            <div style="background: linear-gradient(135deg, rgba(${badge.color === '#f093fb' ? '240,147,251' : '245,87,108'},0.3), rgba(255,215,0,0.3)); padding: 20px; border-radius: 15px; margin: 20px 0;">
                                <h4 style="font-size: 1.5em; margin: 10px 0;">ğŸ¨ ${badge.name}</h4>
                                <p style="font-size: 1.1em; margin: 10px 0;">${badge.description}</p>
                                <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-top: 10px;">
                                    <strong>Level ${badge.level} Badge</strong><br>
                                    <span style="font-size: 0.9em;">You've earned ${savedScore} points!</span>
                                </div>
                            </div>
                            <button class="success large" onclick="mintBadge()" style="font-size: 1.3em; padding: 20px 40px;">
                                âœ¨ Mint My ${badge.name}! âœ¨
                            </button>
                        </div>
                    `;
                } else {
                    const nextBadge = badgeTiers[0]; // First badge
                    const needed = nextBadge.points - savedScore;
                    const progress = (savedScore / nextBadge.points * 100);
                    
                    content.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 4em; margin: 20px 0; opacity: 0.5; filter: grayscale(100%);">${nextBadge.emoji}</div>
                            <h3 style="font-size: 1.5em; margin: 10px 0;">Almost There!</h3>
                            <p style="font-size: 1.1em; margin: 15px 0;">
                                Collect <strong>${needed} more points</strong> to unlock your first badge:<br>
                                <strong style="color: ${nextBadge.color};">${nextBadge.name} ${nextBadge.emoji}</strong>
                            </p>
                            <div style="background: rgba(0,0,0,0.2); height: 20px; border-radius: 10px; margin: 20px 0; overflow: hidden;">
                                <div style="height: 100%; background: linear-gradient(90deg, #4facfe, #00f2fe); width: ${progress}%; transition: width 0.5s;"></div>
                            </div>
                            <p style="font-size: 1.05em; opacity: 0.9;">You have ${savedScore} / ${nextBadge.points} points</p>
                            
                            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-top: 25px;">
                                <strong style="font-size: 1.2em;">ğŸŒŸ All Available Badges:</strong>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                                    ${badgeTiers.map(badge => `
                                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; ${savedScore >= badge.points ? `border: 2px solid ${badge.color};` : 'opacity: 0.5;'}">
                                            <div style="font-size: 2.5em;">${badge.emoji}</div>
                                            <strong>${badge.name}</strong><br>
                                            <span style="font-size: 0.85em;">Level ${badge.level}</span><br>
                                            <span style="font-size: 0.8em;">${badge.points} pts</span>
                                            ${savedScore >= badge.points ? '<br><span style="color: #10b981; font-size: 0.9em;">âœ“ Unlocked!</span>' : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (err) {
                content.innerHTML = `<div class="message error">Error checking badge status: ${err.message}</div>`;
            }
        }
        
        async function mintBadge() {
            const content = document.getElementById('nftContent');
            try {
                content.innerHTML = '<div class="loading"><div class="spinner"></div><p>Minting your badge...</p></div>';
                const tx = await nft.mint('ipfs://QmMathMintBadge/metadata.json');
                await tx.wait();
                content.innerHTML = '<div class="message success"><strong>ğŸ‰ Badge Minted!</strong><br>Check MetaMask NFTs tab!</div>';
                setTimeout(checkNFTStatus, 2000);
            } catch (err) {
                content.innerHTML = `<div class="message error">Minting failed: ${err.message}</div>`;
                setTimeout(checkNFTStatus, 3000);
            }
        }
        
        // Load Leaderboard
        async function loadLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            try {
                const readProvider = new ethers.providers.JsonRpcProvider(MEZO_TESTNET.rpcUrls[0]);
                const readQuiz = new ethers.Contract(QUIZ_ADDR, QUIZ_ABI, readProvider);
                
                const result = await readQuiz.getLeaderboard();
                const addrs = result[0];
                const scores = result[1];
                
                if (addrs.length === 0) {
                    content.innerHTML = '<div class="message info">No players yet! Be the first! ğŸš€</div>';
                    return;
                }
                
                let html = '<div class="leaderboard">';
                for (let i = 0; i < addrs.length; i++) {
                    const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1) + '.';
                    const short = addrs[i].substring(0, 6) + '...' + addrs[i].substring(38);
                    const isMe = userAddr && addrs[i].toLowerCase() === userAddr.toLowerCase();
                    html += `
                        <div class="leader-item ${isMe ? 'me' : ''}">
                            <span class="leader-rank">${medal}</span>
                            <span class="leader-address">${short} ${isMe ? '(YOU!)' : ''}</span>
                            <span class="leader-score">${scores[i]} pts</span>
                        </div>
                    `;
                }
                html += '</div>';
                content.innerHTML = html;
            } catch (err) {
                content.innerHTML = `<div class="message error">Failed to load: ${err.message}</div>`;
            }
        }
        
        // MUSD Boost
        function toggleBoost() {
            const toggleElement = document.getElementById('boostToggle');
            if (!toggleElement) return;
            
            boostEnabled = toggleElement.checked;
            if (boostEnabled && musdBalance < 1) {
                toggleElement.checked = false;
                boostEnabled = false;
                alert('You need 1+ MUSD to enable boost!');
                return;
            }
            
            // Show/hide boost active message
            const boostActiveMsg = document.getElementById('boostActiveMsg');
            if (boostActiveMsg) {
                if (boostEnabled) {
                    boostActiveMsg.classList.remove('hidden');
                } else {
                    boostActiveMsg.classList.add('hidden');
                }
            }
        }
        
        // Quiz Logic
        function generateQuestions() {
            quizQuestions = [];
            const maxNumber = (currentMode === 'rapid') ? 12 : 10;
            
            for (let i = 0; i < totalQuestions; i++) {
                let a, b;
                
                if (practiceTable !== null) {
                    // Practice mode - use selected table
                    a = practiceTable;
                    b = Math.floor(Math.random() * 10) + 1;
                    if (Math.random() > 0.5) {
                        [a, b] = [b, a]; // Randomize order sometimes
                    }
                } else {
                    // Classic or Rapid mode - random tables
                    a = Math.floor(Math.random() * maxNumber) + 1;
                    b = Math.floor(Math.random() * maxNumber) + 1;
                }
                
                const correct = a * b;
                const options = [correct];
                
                // Generate wrong answers
                while (options.length < 4) {
                    let wrong;
                    if (correct < 20) {
                        wrong = Math.floor(Math.random() * 50) + 1;
                    } else if (correct < 50) {
                        wrong = Math.floor(Math.random() * 100) + 1;
                    } else {
                        wrong = Math.floor(Math.random() * 150) + 1;
                    }
                    if (!options.includes(wrong) && wrong !== correct) {
                        options.push(wrong);
                    }
                }
                
                options.sort(() => Math.random() - 0.5);
                quizQuestions.push({ a, b, correct, options });
            }
        }
        
        function startQuiz() {
            generateQuestions();
            currentQuestion = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            points = 0;
            
            // Hide all start screens
            document.getElementById('modeSelection').classList.add('hidden');
            document.getElementById('tableSelection').classList.add('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            
            // Show play screen
            document.getElementById('quizPlay').classList.remove('hidden');
            
            // Set mode label
            let modeLabel = '';
            if (currentMode === 'classic') modeLabel = 'ğŸ¯ Classic Mode';
            else if (currentMode === 'practice') modeLabel = `ğŸ“š Practice: ${practiceTable}x Table`;
            else if (currentMode === 'rapid') modeLabel = 'âš¡ Rapid Fire';
            document.getElementById('modeLabel').textContent = modeLabel;
            
            showQuestion();
        }
        
        function showQuestion() {
            const q = quizQuestions[currentQuestion];
            document.getElementById('question').textContent = `${q.a} Ã— ${q.b} = ?`;
            document.getElementById('questionProgress').textContent = `Question ${currentQuestion + 1}/${totalQuestions}`;
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt);
                optionsDiv.appendChild(btn);
            });
            
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            startTimer();
        }
        
        function startTimer() {
            timeLeft = questionTimeLimit;
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('timer').classList.remove('warning');
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                const warningThreshold = questionTimeLimit <= 10 ? 3 : 5;
                if (timeLeft <= warningThreshold) {
                    document.getElementById('timer').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer(null);
                }
            }, 1000);
        }
        
        function checkAnswer(answer) {
            clearInterval(timerInterval);
            
            const q = quizQuestions[currentQuestion];
            const correct = answer === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.onclick = null;
                if (parseInt(opt.textContent) === q.correct) {
                    opt.classList.add('correct');
                } else if (opt.textContent === String(answer)) {
                    opt.classList.add('wrong');
                }
            });
            
            if (correct) {
                correctAnswers++;
                const earnedPoints = boostEnabled ? 15 : 10;
                points += earnedPoints;
                document.getElementById('feedback').textContent = `âœ… Correct! +${earnedPoints} points`;
            } else {
                wrongAnswers++;
                points = Math.max(0, points - 1);
                document.getElementById('feedback').textContent = `âŒ Wrong! Answer was ${q.correct}. -1 point`;
            }
            
            document.getElementById('feedback').classList.remove('hidden');
            
            setTimeout(() => {
                currentQuestion++;
                document.getElementById('feedback').classList.add('hidden');
                
                if (currentQuestion < totalQuestions) {
                    showQuestion();
                } else {
                    showResults();
                }
            }, 2000);
        }
        
        function showResults() {
            document.getElementById('quizPlay').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('pointsEarned').textContent = points;
            document.getElementById('wrongCount').textContent = wrongAnswers;
            
            // Show boost applied message if boost was used
            if (boostEnabled && musdBalance >= 1) {
                document.getElementById('boostAppliedMessage').classList.remove('hidden');
            }
            
            // Show wallet required message if not connected
            if (!userAddr) {
                document.getElementById('walletRequiredMsg').classList.remove('hidden');
            }
            
            if (userAddr) {
                document.getElementById('pendingPointsItem').classList.remove('hidden');
                document.getElementById('pendingPoints').textContent = points;
            }
        }
        
        function playAgain() {
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('saveMessage').classList.add('hidden');
            document.getElementById('boostAppliedMessage').classList.add('hidden');
            document.getElementById('walletRequiredMsg').classList.add('hidden');
            document.getElementById('modeSelection').classList.remove('hidden');
            
            // Reset to defaults
            currentMode = 'classic';
            practiceTable = null;
            totalQuestions = 5;
            questionTimeLimit = 15;
        }
        
        async function saveScore() {
            const msg = document.getElementById('saveMessage');
            if (!userAddr || !quiz) {
                msg.className = 'message warning';
                msg.innerHTML = '<strong>âš ï¸ Connect Your Bank First!</strong><br>Switch to the "ğŸ¦ Bank" tab above to connect or create your bank!';
                msg.classList.remove('hidden');
                return;
            }
            
            try {
                let pts = points;
                let finalPts = pts;
                
                // Apply boost if enabled (the boost was already applied during quiz)
                // We don't double-apply, just send the points we calculated
                
                msg.className = 'message info';
                msg.innerHTML = '<strong>â³ Saving to your bank on the blockchain...</strong><br>This might take a few seconds. Please confirm in MetaMask!';
                msg.classList.remove('hidden');
                
                const tx = await quiz.updateScore(userAddr, pts);
                
                msg.className = 'message info';
                msg.innerHTML = '<strong>â³ Transaction submitted!</strong><br>Waiting for blockchain confirmation...';
                
                await tx.wait();
                
                msg.className = 'message success';
                msg.innerHTML = `<strong>âœ… Success! Your Bank Got Bigger!</strong><br>${pts} points have been saved to your bank forever! ğŸ‰`;
                
                // Reset points after successful save
                points = 0;
                document.getElementById('pendingPoints').textContent = '0';
                document.getElementById('pendingPointsItem').classList.add('hidden');
                
                if (boostEnabled) {
                    document.getElementById('boostToggle').checked = false;
                    boostEnabled = false;
                    document.getElementById('boostActiveMsg').classList.add('hidden');
                }
                
                setTimeout(() => {
                    if (userAddr) {
                        refreshBankData();
                    }
                    loadLeaderboard();
                }, 1500);
                
            } catch (err) {
                console.error('Save score error:', err);
                msg.className = 'message error';
                let errorMsg = '<strong>âŒ Oops! Something Went Wrong</strong><br>';
                
                if (err.message.includes('user rejected')) {
                    errorMsg += 'You cancelled the transaction. No worries! Click "Save" again when ready.';
                } else if (err.message.includes('insufficient funds')) {
                    errorMsg += 'Not enough tBTC for gas fees. Get free tBTC from: <a href="https://faucet.test.mezo.org" target="_blank" style="color: #4facfe; font-weight: bold; text-decoration: underline;">faucet.test.mezo.org</a>';
                } else {
                    errorMsg += `Error: ${err.message}<br><br>ğŸ’¡ Tip: Make sure you have some tBTC for gas fees!`;
                }
                
                msg.innerHTML = errorMsg;
                msg.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
